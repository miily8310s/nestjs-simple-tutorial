# Nest.js é–‹ç™ºäº‹å§‹ã‚ãƒ¡ãƒ¢

## Nest.js ã¨ã¯

Nest.js ã¨ã¯ Node.js ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚TypeScriptï¼ˆä»¥ä¸‹ TSï¼‰ã§ã®é–‹ç™ºãŒãƒ¡ã‚¤ãƒ³ã¨ãªã‚Šã¾ã™ãŒã€JavaScriptï¼ˆä»¥ä¸‹ JSï¼‰ã§ã®é–‹ç™ºã‚‚å¯èƒ½ã§ã™ã€‚
[Express](https://expressjs.com/)ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã‚‚ã—ãã¯[Fastify](https://www.fastify.io/)ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã¨ã„ã£ãŸ HTTP ã‚µãƒ¼ãƒãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ã‚³ã‚¢ã«å‹•ä½œã™ã‚‹ä»•çµ„ã¿ã¨ãªã£ã¦ãŠã‚Šã€å®Ÿéš›ã“ã‚Œã‚‰ã® HTTP ã‚µãƒ¼ãƒãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ç­‰ã‚’`import`ã—ã¦ãã¦ä½¿ã†ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

https://docs.nestjs.com/

ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯[Angular](https://angular.jp/)ã«å¼·ã„å½±éŸ¿ã‚’å—ã‘ã¦ãŠã‚Šã€ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’æ´»ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°ã‚„é–‹ç™ºãƒ«ãƒ¼ãƒ«ã®å¼·åˆ¶ã®ä»•æ–¹/å®Ÿè£…ã¨ç–çµåˆã«ãªã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã«ã¯ãã®å½±éŸ¿ãŒä¼ºãˆã¾ã™ã€‚ãŸã ã“ã†ã—ãŸç¡¬ã‚ãªå°è±¡ã‚’å—ã‘ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ã“ã‚Œã¾ã§æ±ºå®šæ‰“ãŒãªãå•é¡Œã¨ãªã£ã¦ã„ãŸ Node.js/ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ JS é–‹ç™ºã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é›£ã—ã•ã‚’è§£æ±ºã™ã‚‹ã‚‚ã®ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚

ã“ã†ã—ãŸ TS ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã‹ã¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆãŒå—ã‘å…¥ã‚Œã‚‰ã‚ŒãŸã®ã‹ã€å›½å†…ã§ã‚‚ã“ã“ 1 å¹´ã®é–“ã«æ¡ç”¨äº‹ä¾‹ãŒå¢—ãˆã¦ãŠã‚Šã€ä»Šå¾Œã‚‚å¢—ãˆã‚‹ã“ã¨ãŒäºˆæƒ³ã•ã‚Œã¾ã™ã€‚

https://engineering.mercari.com/blog/entry/20210818-mercari-shops-nestjs-graphql-server/

https://www.forcia.com/blog/002380.html

https://techblog.yahoo.co.jp/entry/2020121530052952/

ã¾ãŸã€ãã®ä»–ã®ç‰¹å¾´ã¨ã—ã¦ã¯ä»¥ä¸‹ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

- RESTAPI ã ã‘ã§ã¯ãªãã€ã‚‚ã¡ã‚ã‚“ GraphQL ã‚µãƒ¼ãƒãƒ¼ã®é–‹ç™ºã‚‚å¯èƒ½
- Nest Cli ã§ç°¡å˜ã«ã‚¢ãƒ—ãƒªã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆå‡ºæ¥ã‚‹
- ãƒ†ã‚¹ãƒˆç”¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒã™ã§ã«ç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ç–çµåˆãªæ§‹æˆã®ãŠã‹ã’ã§ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ä½œæˆãŒå®¹æ˜“
- OpenAPIï¼ˆSwaggerï¼‰ã®ã‚µãƒãƒ¼ãƒˆï¼ˆè¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼‰
- è±Šå¯Œãªå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚µãƒ³ãƒ—ãƒ«é›†

ã¡ãªã¿ã«å…¬å¼ã‚µã‚¤ãƒˆã®ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒæœ¬å½“ã«ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã«ãªã£ã¦ã„ã‚‹ç‚¹ã¯å€‹äººçš„ã«ã™ã”ãå¥½ãã§ã™ã€‚

## é–‹ç™ºç’°å¢ƒ

MacBook Pro(M1 2020)
macOS Monterey 12.1

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

https://docs.nestjs.com/first-steps#setup

```bash
# npmã®å ´åˆ
# npm i -g @nestjs/cli

yarn global add @nestjs/cli
which nest
# /Users/hogehoge/.yarn/bin/nest ã¨è¿”å´ã•ã‚ŒãŸ

# nest new <ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå> ã§ç”Ÿæˆå¯èƒ½
nest new nest new nestjs-simple-tutorial

âš¡  We will scaffold your app in a few seconds..

CREATE nestjs-simple-tutorial/.eslintrc.js (631 bytes)
CREATE nestjs-simple-tutorial/.prettierrc (51 bytes)
CREATE nestjs-simple-tutorial/README.md (3339 bytes)
CREATE nestjs-simple-tutorial/nest-cli.json (64 bytes)
CREATE nestjs-simple-tutorial/package.json (2011 bytes)
CREATE nestjs-simple-tutorial/tsconfig.build.json (97 bytes)
CREATE nestjs-simple-tutorial/tsconfig.json (546 bytes)
CREATE nestjs-simple-tutorial/src/app.controller.spec.ts (617 bytes)
CREATE nestjs-simple-tutorial/src/app.controller.ts (274 bytes)
CREATE nestjs-simple-tutorial/src/app.module.ts (249 bytes)
CREATE nestjs-simple-tutorial/src/app.service.ts (142 bytes)
CREATE nestjs-simple-tutorial/src/main.ts (208 bytes)
CREATE nestjs-simple-tutorial/test/app.e2e-spec.ts (630 bytes)
CREATE nestjs-simple-tutorial/test/jest-e2e.json (183 bytes)

# ã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã‹ã®è³ªå•ãŒæ¥ã‚‹
Which package manager would you â¤ï¸  to use?
  npm
â¯ yarn
  pnpm


ğŸš€  Successfully created project nestjs-simple-tutorial
ğŸ‘‰  Get started with the following commands:

$ cd nestjs-simple-tutorial
$ yarn run start


                          Thanks for installing Nest ğŸ™
                 Please consider donating to our open collective
                        to help us maintain this package.


               ğŸ·  Donate: https://opencollective.com/nest


$ cd nestjs-simple-tutorial && code .
```

## åˆæœŸç”Ÿæˆã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¤ã„ã¦

ã‚µãƒ¼ãƒãƒ¼ã®ç«‹ã¡ä¸Šã’

```bash
yarn run start
# å©ãã¨ `dist/`ãƒ•ã‚©ãƒ«ãƒ€ãŒç”Ÿæˆã•ã‚Œã‚‹

yarn run v1.22.17
$ nest start
[Nest] 23190  - 2022/03/01 8:38:00     LOG [NestFactory] Starting Nest application...
[Nest] 23190  - 2022/03/01 8:38:00     LOG [InstanceLoader] AppModule dependencies initialized +30ms
[Nest] 23190  - 2022/03/01 8:38:00     LOG [RoutesResolver] AppController {/}: +2ms
[Nest] 23190  - 2022/03/01 8:38:00     LOG [RouterExplorer] Mapped {/, GET} route +1ms
[Nest] 23190  - 2022/03/01 8:38:00     LOG [NestApplication] Nest application successfully started +1ms
```

http://localhost:3000/ ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€Hello World!ã€€ã®æ–‡å­—ãŒï¼

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªéšå±¤ã«ã¤ã„ã¦

ãƒ¡ã‚¤ãƒ³ã¯ src ãƒ•ã‚©ãƒ«ãƒ€
root ç›´ä¸‹ã«ã¯ E2E ãƒ†ã‚¹ãƒˆç”¨ã® test ãƒ•ã‚©ãƒ«ãƒ€ã‚‚ã„ã‚‹ãŒã€ä»Šå›ã¯è§¦ã‚Œãªã„ã€‚

```md
src/
|- app.controller.spec.ts
|- app.controller.ts
|- app.module.ts
|- app.service.ts
|- main.ts
```

ã§ã¯ä¸€ã¤ãšã¤èª¬æ˜ã—ã¦ã„ãã€‚

https://docs.nestjs.com/first-steps#setup

ã¾ãš Nest.js ã§ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹ä¸Šã§ä»¥ä¸‹ã® 4 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…é ˆã¨ãªã‚Šã¾ã™ã€‚

- main
- controllers
- providers
- modules

ã“ã‚Œã‚‰ã®å½¹å‰²ã‚’å…ˆç¨‹ã®`src/`ç›´ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ç´ä»˜ã‘ãªãŒã‚‰èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

## main.ts

main ã®å½¹å‰²ã‚’å¸ã‚‹ã®ãŒã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
Nest.js ã‚¢ãƒ—ãƒªã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ãªã‚Šã€ã‚µãƒ¼ãƒã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆï¼†ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®ã¿è¡Œã„ã¾ã™ã€‚

[Express](https://expressjs.com/)ã‚’æ‰±ã£ãŸã“ã¨ãŒã‚ã‚‹äººã«ã¯`const app = express()`ã€œ`app.listen()`ã¨åŒã˜ã“ã¨ã—ã¦ã„ã‚‹ãªãã£ã¦æ€ã£ã¦ã‚‚ã‚‰ãˆã°å¤§ä¸ˆå¤«ã§ã™ã€‚

```ts: src/main.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
  // NestFactoryã¨ã„ã†Functionã§Nest.jsã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ
  const app = await NestFactory.create(AppModule);
  // 3000ç•ªportã§ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹
  await app.listen(3000);
}
bootstrap();
```

## app.controller.ts / app.controller.spec.ts

`controllers`ã®å½¹å‰²ã‚’å¸ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ç®‡æ‰€ã§ã™ã€‚
åˆæœŸã‚³ãƒ¼ãƒ‰ã§ã¯`@Get()`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã€GET ã§`[rootURL]/`ã‚’å©ã„ãŸã¨ãå‘¼ã³å‡ºã•ã‚Œã‚‹`getHello`ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä»Šå›ã¯è§¦ã‚Œã¾ã›ã‚“ãŒã€ã„ã‚ã‚†ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚„èªè¨¼ç¢ºèªãªã©ã®ã‚¬ãƒ¼ãƒ‰å‡¦ç†ã‚‚ã“ã“ã§è¨­å®šã—ã¾ã™ã€‚
`AppService`ã«ã¤ã„ã¦ã¯å¾Œã§èª¬æ˜ã—ã¾ã™ã€‚

```ts: src/app.controller.ts
import { Controller, Get } from '@nestjs/common';
import { AppService } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get()
  getHello(): string {
    return this.appService.getHello();
  }
}
```

ãªãŠã€`app.controller.spec.ts`ã¯ JS/TS ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹[Jest](https://jestjs.io/ja/) ã‚’ä½¿ã£ã¦ã€`app.controller.ts`ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ç®‡æ‰€ã§ã™ã€‚

## app.service.ts

`providers`ã®å½¹å‰²ã‚’å¸ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚`controllers`ã®å‡¦ç†ã‚’è©³ç´°ã«å®šç¾©ã™ã‚‹å ´æ‰€ã ã¨æ€ã£ã¦ã‚‚ã‚‰ãˆã°å¤§ä¸ˆå¤«ã§ã™ã€‚

ä»Šå›ã¯è©³ã—ãè§¦ã‚Œã¾ã›ã‚“ãŒã€ã“ã“ã§ã¯`@Injectable()`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€DIï¼ˆDependency Injection/ä¾å­˜æ€§æ³¨å…¥ï¼‰ã®ä»•çµ„ã¿ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

DI ã«ã¤ã„ã¦ã‚‚ã£ã¨çŸ¥ã‚ŠãŸã„æ–¹ã¯ã“ã¡ã‚‰ã®è³‡æ–™ã‚’èª­ã‚“ã ã¿ã¦ãã ã•ã„ã€‚
https://qiita.com/hinom77/items/1d7a30ba5444454a21a8
https://qiita.com/ritukiii/items/de30b2d944109521298f

```ts: src/app.service.ts
import { Injectable } from '@nestjs/common';

@Injectable()
export class AppService {
  // APIãŒå‘¼ã³å‡ºã•ã‚ŒãŸã¨ãã«'Hello World!'ã‚’è¿”å´ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©
  getHello(): string {
    return 'Hello World!';
  }
}
```

## app.module.ts

`modules`ã®å½¹å‰²ã‚’å¸ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚`controllers` ã¨ã‹ `providers` ã‚’å–ã‚Šã¾ã¨ã‚ã‚‹ã¨ã“ã‚ã§ã™ã€‚

```ts: src/app.module.ts
import { Module } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';

@Module({
  imports: [],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}

```

# ä»Šå¾Œã—ãŸã„ã“ã¨

ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚„ Angular ãƒ©ã‚¤ã‚¯ãªæ›¸ãæ–¹ã«ã¾ã ã¾ã æ…£ã‚Œã¦ã„ãªã„ã®ã§ã€ã¾ãšã¯å…¬å¼ã® Overview ã®å…¨ãƒšãƒ¼ã‚¸ã‚’ä¸€å‘¨ã—ã‚ˆã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ãšã£ã¨å‹‰å¼·ã§ãã¦ãªã‹ã£ãŸ TypeORM ã®æ´»ç”¨ ã‚„ GraphQL å®Ÿè£…ã‚ãŸã‚Šã«ã‚‚è¸ã¿è¾¼ã‚ã‚Œã°ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

# å‚è€ƒã«ã—ãŸãƒšãƒ¼ã‚¸

https://docs.nestjs.com/first-steps

https://zenn.dev/hakushun/articles/0b0443ac6fd8d7

https://qiita.com/elipmoc101/items/9b1e6b3efa62f3c2a166
